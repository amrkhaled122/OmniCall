<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OmniCall</title>

  <!-- Icons / Manifest -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <!-- cache-bust added to force Pages rebuild -->
  <link rel="manifest" href="manifest.json?v=20251031T0000" />
  <meta name="theme-color" content="#000000" />

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="OmniCall" />

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <header class="header">
      <div class="logo-wrap">
        <img src="icon-192.png" alt="OmniCall logo" class="logo" />
        <h1>OmniCall</h1>
      </div>
      <p class="subtle" id="header-subtitle">
        Get instant notifications when a match is found.
      </p>
    </header>

    <!-- iOS Install Instructions -->
    <section id="ios-install" class="card install-card" style="display:none;">
      <h2>üì± Install OmniCall on iPhone</h2>
      <p class="subtle">To receive notifications, you must first add this app to your Home Screen.</p>
      
      <div class="install-steps">
        <div class="install-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <strong>Tap the Share button</strong>
            <p>Look for the <span style="font-size:1.3em;">‚¨ÜÔ∏è</span> icon at the bottom of Safari</p>
          </div>
        </div>
        
        <div class="install-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <strong>Select "Add to Home Screen"</strong>
            <p>Scroll down and tap this option in the menu</p>
          </div>
        </div>
        
        <div class="install-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <strong>Tap "Add"</strong>
            <p>Confirm by tapping Add in the top-right corner</p>
          </div>
        </div>
        
        <div class="install-step">
          <div class="step-number">4</div>
          <div class="step-content">
            <strong>Open from Home Screen</strong>
            <p>Find the OmniCall icon on your home screen and open it from there</p>
          </div>
        </div>
      </div>
      
      <div class="install-note">
        <strong>Note:</strong> After adding to Home Screen, open OmniCall from there, then pair it with your PC using the QR code and enable notifications.
      </div>
    </section>

    <!-- Android Install Instructions -->
    <section id="android-install" class="card install-card" style="display:none;">
      <h2>üì± Install OmniCall on Android</h2>
      <p class="subtle">To receive notifications, you must first install this app to your device.</p>
      
      <div class="install-steps">
        <div class="install-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <strong>Tap the Menu button</strong>
            <p>Look for the <span style="font-size:1.3em;">‚ãÆ</span> icon (three dots) at the top-right of Chrome</p>
          </div>
        </div>
        
        <div class="install-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <strong>Select "Add to Home screen" or "Install app"</strong>
            <p>You may see either option depending on your Chrome version</p>
          </div>
        </div>
        
        <div class="install-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <strong>Tap "Add" or "Install"</strong>
            <p>Confirm the installation when prompted</p>
          </div>
        </div>
        
        <div class="install-step">
          <div class="step-number">4</div>
          <div class="step-content">
            <strong>Open the installed app</strong>
            <p>Find the OmniCall icon on your home screen or app drawer and open it</p>
          </div>
        </div>
      </div>
      
      <div class="install-note">
        <strong>Note:</strong> After installing, open OmniCall from your home screen, then pair it with your PC using the QR code and enable notifications.
      </div>
    </section>

    <!-- Mobile Controls (shown only on installed PWA) -->
    <section id="mobile-controls" class="card" style="display:none;">
      <h2>Enable Notifications</h2>
      <p class="subtle">
        Scan the QR code from your PC app to pair, then enable notifications to receive match alerts.
      </p>

      <div class="btn-row">
        <button id="scanQR" class="btn-ghost">Scan QR to Pair</button>
        <button id="enableNotifications" class="btn-primary">Enable Notifications</button>
      </div>

      <div id="status" class="status">Status: Not Connected</div>
    </section>

    <!-- Desktop-only message -->
    <section id="desktop-message" class="card" style="display:none;">
      <h2>üì± Open on Your Phone</h2>
      <p class="subtle">
        To receive match notifications, please open this website on your <strong>iPhone</strong> or <strong>Android</strong> device.
      </p>
      <p class="subtle" style="margin-top: 12px;">
        Notifications are not supported on desktop browsers, but you can view live stats and support the creator below.
      </p>
    </section>

    <!-- Stats and Support (Desktop + Installed Mobile) -->
    <div id="desktop-view" style="display:none;">
      <!-- Stats -->
      <section class="card">
        <h2>Community Stats</h2>
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-num" id="statUsers">0</div>
            <div class="stat-label">Total Users</div>
          </div>
          <div class="stat-box">
            <div class="stat-num" id="statMatches">0</div>
            <div class="stat-label">Total Matches</div>
          </div>
          <div class="stat-box">
            <div class="stat-num" id="statNotifications">0</div>
            <div class="stat-label">Total Notifications Sent</div>
          </div>
        </div>
      </section>

      <!-- Support -->
      <section class="card support">
        <div class="support-media">
          <img src="support_page.jpeg" alt="Dota 2 artwork" class="support-image" />
        </div>
        <div class="support-content">
          <h2>Support the Creator</h2>
          <p class="subtle">
            If this App helps you, you can support its development. Thank you! ‚ù§Ô∏è
          </p>

          <div class="support-items">
            <div class="support-item">
              <div class="support-icon-img">
                <img src="binance.png" alt="Binance" class="support-logo" />
              </div>
              <div class="support-text">
                <div class="support-label">Binance</div>
                <div class="support-detail">
                  Email/ID:
                  <a href="mailto:amrkhaled272@gmail.com">amrkhaled272@gmail.com</a> ¬∑
                  ID: <strong>753805136</strong>
                </div>
              </div>
            </div>

            <div class="support-item">
              <div class="support-icon-img">
                <img src="paypal.png" alt="PayPal" class="support-logo" />
              </div>
              <div class="support-text">
                <div class="support-label">PayPal</div>
                <div class="support-detail">
                  Email:
                  <a href="mailto:amrkhaled122@aucegypt.edu">amrkhaled122@aucegypt.edu</a>
                </div>
              </div>
            </div>
          </div>

          <p class="tiny subtle">Please copy carefully when sending. Much appreciated!</p>
        </div>
      </section>
    </div>

    <footer class="footer">
      <span>¬© <span id="year"></span> Amr Khaled Abdelbaky ‚Äî All rights reserved.</span>
    </footer>
  </main>

  <!-- Scanner overlay -->
  <div id="scanner" class="scanner hidden" aria-hidden="true">
    <div class="scanner-inner">
      <video id="qrVideo" playsinline></video>
      <div class="scan-hint">Point your camera at the QR code from your PC</div>
      <button id="closeScan" class="btn-ghost scan-close">Close</button>
    </div>
  </div>

  <!-- Firebase SDKs (compat) ‚Äî must load BEFORE app.js -->
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-messaging-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>

  <!-- QR decoder (pure JS) -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
  <script src="app.js"></script>
</body>
</html>
